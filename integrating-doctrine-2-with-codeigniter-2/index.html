<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Integrating Doctrine 2 with CodeIgniter 2 | Wildly Inaccurate</title> <meta name="description" content="If you’re looking for a quick way to get Doctrine 2 running with CodeIgniter 2, you might want to download my CodeIgniter 2/Doctrine 2 packageOverviewCodeIgniter is a great PHP framework. The codebase is clean, the documentation is fantastic, and ..."> <link rel="stylesheet" href="/css/main.f9d9659.css"> <link rel="canonical" href="https://wildlyinaccurate.com/integrating-doctrine-2-with-codeigniter-2"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> </head> <body> <nav class="navbar"> <div class="container"> <a href="https://wildlyinaccurate.com" class="navbar__title navbar__link">Wildly Inaccurate</a> <ul class="navbar-nav"> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/about/">About</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/projects/">Projects</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/search/">Search</a> </li> </ul> </div> </nav> <header class="page-header"> <img class="page-header__featured-image" src="/assets/default-featured-image.jpg" srcset="/assets/resized/default-featured-image-290x121.jpg 290w, /assets/resized/default-featured-image-315x132.jpg 315w, /assets/resized/default-featured-image-720x301.jpg 720w, /assets/resized/default-featured-image-940x393.jpg 940w, /assets/resized/default-featured-image-780x326.jpg 780w, /assets/resized/default-featured-image-1280x535.jpg 1280w, /assets/resized/default-featured-image-1360x568.jpg 1360w, /assets/resized/default-featured-image-1680x702.jpg 1680w, /assets/resized/default-featured-image-1840x769.jpg 1840w,  /assets/default-featured-image.jpg 2600w"> <div class="container"> <h1 class="page-header__title">Integrating Doctrine 2 with CodeIgniter 2</h1> <p class="post-meta--header"> Sep 26, 2010 • by Joseph Wynn • posted in <span class="post-meta__data"> [<a href="/category/codeigniter/">codeigniter</a>, <a href="/category/doctrine/">doctrine</a>, <a href="/category/php/">php</a>, <a href="/category/web development/">web development</a>] </span> </p> </div> </header> <article class="post-content"> <p><em>If you’re looking for a quick way to get Doctrine 2 running with CodeIgniter 2, you might want to download my <a href="https://github.com/wildlyinaccurate/CodeIgniter-2-with-Doctrine-2">CodeIgniter 2/Doctrine 2 package</a></em></p> <h2 id="overview">Overview</h2> <p>CodeIgniter is a great PHP framework. The codebase is clean, the <a href="http://codeigniter.com/user_guide/">documentation</a> is fantastic, and it’s regularly updated. Doctrine is a good ORM for the same reasons: it’s very well-written, has <a href="http://www.doctrine-project.org/projects/orm/2.1/docs/en">extensive documentation</a>, and is actively developed. A combination of these two systems makes it easy to build database-oriented web applications quicker than ever before.</p> <p>To get started, download <a href="http://codeigniter.com/download.php">CodeIgniter 2</a> and <a href="http://www.doctrine-project.org/projects/orm.html">Doctrine 2</a> – make sure you use the ‘Download Archive’ link when downloading Doctrine.</p> <!--more--> <h2 id="setting-up-codeigniter">Setting up CodeIgniter</h2> <p>Put all of the CodeIgniter files into a directory on your web server, and configure it to your liking. If you need a guide on how to do this, the best place to look is the <a href="http://codeigniter.com/user_guide/">CodeIgniter User Guide</a>. Keep in mind that Doctrine will load the database configuration from CodeIgniter (application/config/database.php).</p> <h2 id="setting-up-doctrine">Setting up Doctrine</h2> <p>Because Doctrine is an entire system in itself, it worked well as a plugin for CodeIgniter 1. Unfortunately one of the major changes to CodeIgniter 2 is the removal of plugins. EllisLab recommends you refactor your plugins as libraries, so that’s exactly what we will do.</p> <p>Setting up Doctrine as a CodeIgniter library is fairly simple:</p> <ol> <li>Put the Doctrine directory into application/libraries (so that you have a application/libraries/Doctrine directory).</li> <li>Create the file application/libraries/Doctrine.php. This will be our Doctrine bootstrap as well as the library that CodeIgniter loads.</li> <li>Copy the following code into Doctrine.php:</li> </ol> <div class="highlight"><pre><code class="language-php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\ClassLoader</span><span class="p">,</span>
    <span class="nx">Doctrine\ORM\Tools\Setup</span><span class="p">,</span>
    <span class="nx">Doctrine\ORM\EntityManager</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Doctrine</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$em</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/Doctrine/ORM/Tools/Setup.php&#39;</span><span class="p">;</span>
        <span class="nx">Setup</span><span class="o">::</span><span class="na">registerAutoloadDirectory</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">);</span>

        <span class="c1">// Load the database configuration from CodeIgniter</span>
        <span class="k">require</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;config/database.php&#39;</span><span class="p">;</span>

        <span class="nv">$connection_options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;driver&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;pdo_mysql&#39;</span><span class="p">,</span>
            <span class="s1">&#39;user&#39;</span>          <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
            <span class="s1">&#39;password&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
            <span class="s1">&#39;host&#39;</span>          <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;hostname&#39;</span><span class="p">],</span>
            <span class="s1">&#39;dbname&#39;</span>        <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;database&#39;</span><span class="p">],</span>
            <span class="s1">&#39;charset&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;char_set&#39;</span><span class="p">],</span>
            <span class="s1">&#39;driverOptions&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;charset&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;char_set&#39;</span><span class="p">],</span>
            <span class="p">),</span>
        <span class="p">);</span>

        <span class="c1">// With this configuration, your model files need to be in application/models/Entity</span>
        <span class="c1">// e.g. Creating a new Entity\User loads the class from application/models/Entity/User.php</span>
        <span class="nv">$models_namespace</span> <span class="o">=</span> <span class="s1">&#39;Entity&#39;</span><span class="p">;</span>
        <span class="nv">$models_path</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models&#39;</span><span class="p">;</span>
        <span class="nv">$proxies_dir</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models/Proxies&#39;</span><span class="p">;</span>
        <span class="nv">$metadata_paths</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models&#39;</span><span class="p">);</span>

        <span class="c1">// Set $dev_mode to TRUE to disable caching while you develop</span>
        <span class="nv">$config</span> <span class="o">=</span> <span class="nx">Setup</span><span class="o">::</span><span class="na">createAnnotationMetadataConfiguration</span><span class="p">(</span><span class="nv">$metadata_paths</span><span class="p">,</span> <span class="nv">$dev_mode</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$proxies_dir</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$connection_options</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>

        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassLoader</span><span class="p">(</span><span class="nv">$models_namespace</span><span class="p">,</span> <span class="nv">$models_path</span><span class="p">);</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div> <p>There are some parts of this file that you might like to modify to suit your needs:</p> <p><strong>Lines 34-37:</strong></p> <div class="highlight"><pre><code class="language-php"><span class="nv">$models_namespace</span> <span class="o">=</span> <span class="s1">&#39;Entity&#39;</span><span class="p">;</span>
<span class="nv">$models_path</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models&#39;</span><span class="p">;</span>
<span class="nv">$proxies_dir</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models/Proxies&#39;</span><span class="p">;</span>
<span class="nv">$metadata_paths</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;models&#39;</span><span class="p">);</span></code></pre></div> <p>These lines determine where you need to put your model files, and how you instantiate your model classes. With these settings, your models must live in <code>application/models/Entity</code> and be in the <code>Entity</code> namespace. For example instantiating a <code>new Entity\User</code> would load the User class from <code>application/models/Entity/User.php</code></p> <p><strong>Line 40</strong></p> <div class="highlight"><pre><code class="language-php"><span class="nv">$config</span> <span class="o">=</span> <span class="nx">Setup</span><span class="o">::</span><span class="na">createAnnotationMetadataConfiguration</span><span class="p">(</span><span class="nv">$metadata_paths</span><span class="p">,</span> <span class="nv">$dev_mode</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$proxies_dir</span><span class="p">);</span></code></pre></div> <p>This line uses Doctrine’s <code>Setup</code> class to automatically create the metadata configuration. The <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/metadata-drivers.html">Metadata Driver</a> is what Doctrine uses to interpret your models and map them to the database. In this tutorial I have used the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">Annotations Driver</a>. If you would like to use a different metadata driver, change <code>createAnnotationMetadataConfiguration</code> to one of the methods below:</p> <ul> <li><code>createXMLMetadataConfiguration</code> – Uses the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/xml-mapping.html">XML Mapping Driver</a></li> <li><code>createYAMLMetadataConfiguration</code> – Uses the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/yaml-mapping.html">YAML Mapping Driver</a></li> </ul> <p>Notice the <code>$dev_mode</code> variable. This should be true while you are developing, as it does a couple of things:</p> <ol> <li>Automatically generates your proxy classes</li> <li>Uses <code>ArrayCache</code>; a non-persistent caching class</li> </ol> <p>Likewise, when <code>$dev_mode</code> is false:</p> <ol> <li>Prevents your proxy classes from being overwritten</li> <li>Attempts to use one of the following persistent caches, in this order: APC, Xcache, Memcache (127.0.0.1:11211), and Redis (127.0.0.1:6379)</li> </ol> <h2 id="advanced-configuration">Advanced Configuration</h2> <p>For more advanced configuration, read the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/configuration.html">Configuration</a> section of the Doctrine documentation.</p> <h2 id="loading-doctrine">Loading Doctrine</h2> <p>Doctrine can now be loaded in the same way as any other CodeIgniter library:</p> <div class="highlight"><pre><code class="language-php"><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">load</span><span class="o">-&gt;</span><span class="na">library</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">);</span></code></pre></div> <p>Once the Doctrine library is loaded, you can retrieve the Entity Manage like so:</p> <div class="highlight"><pre><code class="language-php"><span class="nv">$em</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span></code></pre></div> <h2 id="defining-models">Defining Models</h2> <p>Building models using the AnnotationDriver is simple. You can build your classes as if they were regular PHP classes, and define the Doctrine metadata in Docblock annotations.</p> <div class="highlight"><pre><code class="language-php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Entity</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> * @Table(name=&quot;user&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
     <span class="c1">// ...</span>
<span class="p">}</span></code></pre></div> <p>The <code>@Entity</code> annotation marks this class for <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/basic-mapping.html#persistent-classes">object-relational persistence</a>. If the table name is not specified (using the <code>@Table</code> annotation), Doctrine will create a table with the same name as the class.</p> <p>Annotations that you will probably use frequently are:</p> <ul> <li><code>@Column</code> – Marks a property for object-relational persistence</li> <li><code>@OneToOne</code>, <code>@ManyToOne</code> and <code>@ManyToMany</code> – Define a relationship between two entities</li> <li><code>@JoinTable</code> – Used when defining a <code>@ManyToMany</code> relationship to specify the database join table</li> </ul> <p>For a full list of the available annotations and their uses, see the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">Annotation Reference</a></p> <p>Below are two sample entities that show a basic one-to-many relationship:</p> <div class="highlight"><pre><code class="language-php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> * @Table(name=&quot;user&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id</span>
<span class="sd">     * @Column(type=&quot;integer&quot;, nullable=false)</span>
<span class="sd">     * @GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=32, unique=true, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$username</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=64, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$password</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=255, unique=true, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$email</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The @JoinColumn is not necessary in this example. When you do not specify</span>
<span class="sd">     * a @JoinColumn annotation, Doctrine will intelligently determine the join</span>
<span class="sd">     * column based on the entity class name and primary key.</span>
<span class="sd">     *</span>
<span class="sd">     * @ManyToOne(targetEntity=&quot;Group&quot;)</span>
<span class="sd">     * @JoinColumn(name=&quot;group_id&quot;, referencedColumnName=&quot;id&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$group</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> * @Table(name=&quot;group&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Group</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id</span>
<span class="sd">     * @Column(type=&quot;integer&quot;, nullable=false)</span>
<span class="sd">     * @GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=32, unique=true, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @OneToMany(targetEntity=&quot;User&quot;, mappedBy=&quot;group&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>
<span class="p">}</span></code></pre></div> <p>It is important to note that any mapped properties on your Entities need to be either <code>private</code> or <code>protected</code>, otherwise <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/architecture.html#entities">lazy-loading might not work as expected</a>. This means that it is necessary to use Java-styled getter and setter methods:</p> <div class="highlight"><pre><code class="language-php"><span class="k">public</span> <span class="k">function</span> <span class="nf">setUsername</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
<span class="p">}</span></code></pre></div> <p>Thankfully you can save a lot of time and <a href="https://wildlyinaccurate.com/useful-doctrine-2-console-commands#orm-generate-entities">automatically generate these methods</a> using the <code>orm:generate-entities</code> command.</p> <h2 id="setting-up-the-doctrine-console">Setting up the Doctrine Console</h2> <p>This step is optional, however the Doctrine Console has some very useful commands so I highly recommend setting it up.</p> <p>All you need to do is create the file application/doctrine.php and copy the following code into it:</p> <div class="highlight"><pre><code class="language-php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;APPPATH&#39;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BASEPATH&#39;</span><span class="p">,</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&#39;/../system/&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ENVIRONMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;development&#39;</span><span class="p">);</span>

<span class="nb">chdir</span><span class="p">(</span><span class="nx">APPPATH</span><span class="p">);</span>

<span class="k">require</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/libraries/Doctrine.php&#39;</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$GLOBALS</span> <span class="k">as</span> <span class="nv">$helperSetCandidate</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$helperSetCandidate</span> <span class="nx">instanceof</span> <span class="nx">\Symfony\Component\Console\Helper\HelperSet</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$helperSet</span> <span class="o">=</span> <span class="nv">$helperSetCandidate</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$doctrine</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine</span><span class="p">;</span>
<span class="nv">$em</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span>

<span class="nv">$helperSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Symfony\Component\Console\Helper\HelperSet</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;db&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Doctrine\DBAL\Tools\Console\Helper\ConnectionHelper</span><span class="p">(</span><span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()),</span>
    <span class="s1">&#39;em&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Doctrine\ORM\Tools\Console\Helper\EntityManagerHelper</span><span class="p">(</span><span class="nv">$em</span><span class="p">)</span>
<span class="p">));</span>

<span class="nx">\Doctrine\ORM\Tools\Console\ConsoleRunner</span><span class="o">::</span><span class="na">run</span><span class="p">(</span><span class="nv">$helperSet</span><span class="p">);</span></code></pre></div> <p>On a Linux or Mac, you can now run <code>./application/doctrine</code> from the command line.</p> <p>If you are on Windows, you can run <code>php.exe application/doctrine.php</code> from the command line. If you are new to running PHP scripts from the command line in Windows, you may want to read <a href="http://php.net/manual/en/install.windows.commandline.php">PHP’s documentation</a>.</p> <h2 id="using-the-doctrine-console">Using the Doctrine Console</h2> <p>If you run the Doctrine console with no arguments, you will be presented with a list of the available commands. For now, we are only interested in the <code>orm:schema-tool</code> commands. If you would like to learn about the other commands you can run a command with the <code>--help</code> flag or read my quick <a href="https://wildlyinaccurate.com/useful-doctrine-2-console-commands">Doctrine console overview</a>.</p> <p><strong>orm:schema-tool:create</strong> will create tables in your database based on your Doctrine models.</p> <p><strong>orm:schema-tool:drop</strong> will do the exact opposite. It is worth noting that this command will only drop tables which have correlating Doctrine models. Any tables that aren’t mapped to a Doctrine model will be left alone.</p> <p><strong>orm:schema-tool:update</strong> will determine if your database schema is out-of-date, and give you the option of updating it. You can execute this command with the <code>--dump-sql</code> flag to see the changes, or the <code>--force</code> flag to execute the changes.</p> <h2 id="using-doctrine">Using Doctrine</h2> <p>Once your models are set up and your database is built, you can access your models using the Doctrine EntityManager. I like shortcuts, so I always instantiate the EntityManager in MY_Controller:</p> <div class="highlight"><pre><code class="language-php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">MY_Controller</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="c1">// Doctrine EntityManager</span>
    <span class="k">public</span> <span class="nv">$em</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>

        <span class="c1">// Not required if you autoload the library</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">load</span><span class="o">-&gt;</span><span class="na">library</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div> <p>Instead of the longer <code>$this-&gt;doctrine-&gt;em</code>, this will allow you to access the EntityManager using <code>$this-&gt;em</code>:</p> <div class="highlight"><pre><code class="language-php"><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entity\User</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&#39;Joseph&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="s1">&#39;secretPassw0rd&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setEmail</span><span class="p">(</span><span class="s1">&#39;josephatwildlyinaccuratedotcom&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span></code></pre></div> <h2 id="final-words">Final Words</h2> <p>If you have been spoiled by Doctrine 1’s magic then you will probably have a hard time wrapping your head around Doctrine 2’s strict object-oriented approach to everything. When learning your way around a new system, documentation can be your best friend or your worst enemy. Lucky for us, the Doctrine team has written some fantastic documentation. If you are having trouble getting something to work, one of the first things you should do is <abbr title="Read The Manual">RTFM</abbr> (<a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/index.html">Doctrine</a>; <a href="http://codeigniter.com/user_guide/">CodeIgniter</a>).</p> <p>Good luck, I hope you enjoy using these powerful tools!</p> </article> <footer class="post-meta post-meta--footer"> <p> This post was written by <strong>Joseph Wynn</strong> on <strong>26 September, 2010</strong>, and last updated on <strong>15 January, 2015</strong>. It was posted in <span class="post-meta__data"> [<a href="/category/codeigniter/">codeigniter</a>, <a href="/category/doctrine/">doctrine</a>, <a href="/category/php/">php</a>, <a href="/category/web development/">web development</a>] </span> and tagged with <span class="post-meta__data"> [<a href="/tag/codeigniter 2/">codeigniter 2</a>, <a href="/tag/combine/">combine</a>, <a href="/tag/doctrine 2/">doctrine 2</a>, <a href="/tag/guide/">guide</a>] </span> </p> </footer> <div class="post-comments" id="disqus_thread"></div> <script>var disqus_shortname = 'wildlyinaccurate';
    var disqus_url = 'https://wildlyinaccurate.com/integrating-doctrine-2-with-codeigniter-2';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script> <footer class="page-footer"> <ul class="social-media"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="social-media__icon"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"> </svg> </span> <span class="username">wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/Joseph_Wynn"> <span class="social-media__icon"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"> </svg> </span> <span class="username">Joseph_Wynn</span> </a> </li> </ul> <p class="site-description site-description--footer">A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News. </p> </footer> <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-20744182-3', 'auto');
          ga('send', 'pageview');</script> <script>(function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.src = '//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('p');
                p.appendChild(s);

                n = document.querySelector('.post-content > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })();</script> </body> </html>