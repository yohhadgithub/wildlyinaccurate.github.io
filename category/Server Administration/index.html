<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Category: Server Administration | Wildly Inaccurate</title> <meta name="description" content="A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News.
"> <link rel="stylesheet" href="/css/main.360c99e.css"> <link rel="canonical" href="https://wildlyinaccurate.com/category/Server%20Administration"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> </head> <body> <nav class="navbar"> <div class="container"> <a href="https://wildlyinaccurate.com" class="navbar__title navbar__link">Wildly Inaccurate</a> <ul class="navbar-nav"> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/about/">About</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/projects/">Projects</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/search/">Search</a> </li> </ul> </div> </nav> <header class="page-header page-header--no-meta"> <img class="page-header__featured-image" src="/assets/default-featured-image.jpg" srcset="/assets/resized/default-featured-image-320x134.jpg 320w, /assets/resized/default-featured-image-360x150.jpg 360w, /assets/resized/default-featured-image-720x301.jpg 720w, /assets/resized/default-featured-image-940x393.jpg 940w, /assets/resized/default-featured-image-1140x476.jpg 1140w, /assets/resized/default-featured-image-1280x535.jpg 1280w, /assets/resized/default-featured-image-1360x568.jpg 1360w, /assets/resized/default-featured-image-1680x702.jpg 1680w, /assets/resized/default-featured-image-1840x769.jpg 1840w,  /assets/default-featured-image.jpg 2600w"> <div class="container"> <h1 class="page-header__title">Category: Server Administration</h1> </div> </header> <section class="posts-index"> <article class="post-summary"> <span class="post-summary__meta">Aug 1, 2013</span> <h3> <a class="post-summary__link" href="/installing-php-on-debian-without-apache/">Installing PHP on Debian without Apache</a> </h3> <p></p><p>When you <code>apt-get install php5</code> on a Debian/Ubuntu server, you’ll notice that APT will automatically install a bunch of <code>apache2</code> packages as well. This can be pretty annoying if you’re planning on using another web server (or no web server at all).</p> <p>If you take a look at the package dependencies (<a href="http://packages.debian.org/wheezy/php5">Debian</a>/<a href="http://packages.ubuntu.com/quantal/php5">Ubuntu</a>) you’ll see why this happens - <code>php5</code> needs one of either <code>libapache2-mod-php5</code>, <code>libapache2-mod-php5filter</code>, <code>php5-cgi</code>, or <code>php5-fpm</code>. APT doesn’t care which package it installs; it just picks the first package that satisfies the dependency, which is why you get the <code>apache2</code> packages.</p> <p>You can get around this by installing one of the other dependencies <em>before</em> <code>php5</code>. For example, <code>apt-get install php5-fpm php5</code> or <code>apt-get install php5-cgi php5</code>.</p> <a href="/installing-php-on-debian-without-apache/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">Aug 1, 2013</span> <h3> <a class="post-summary__link" href="/using-ssh-agent-forwarding-with-vagrant/">Using SSH agent forwarding with Vagrant</a> </h3> <p></p><p>Sometimes you’ll want to use your local SSH keys on your Vagrant boxes, so that you don’t have to manage password-less keys for each box. This can be done with SSH agent forwarding, which is <a href="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html">explained in great detail on Unixwiz.net</a>.</p> <p>Setting this up is fairly straightforward. On the host machine, you need to add the following to <code>~/.ssh/config</code> (which you should create if it doesn’t exist):</p> <div><pre><code>host your.domain.com
    ForwardAgent yes
</code></pre> </div> <p>You need to replace <code>your.domain.com</code> with either the domain or the IP address of your Vagrant box. You can wildcard this with <code>host *</code>, but this is a <em>really</em> bad idea because it lets every server you SSH to access your keys.</p> <p>Once you’ve done that, just run <code>ssh-add</code> to ensure you ensure your identities are added to the SSH agent.</p> <p>Now, add the following to the config block in your Vagrantfile:</p> <div><pre><code>config.ssh.forward_agent = true
</code></pre> </div> <p>That’s all it takes. You can make sure it worked by comparing the output of <code>ssh-add -L</code> on both the host machine and the guest box.</p> <a href="/using-ssh-agent-forwarding-with-vagrant/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">May 20, 2013</span> <h3> <a class="post-summary__link" href="/blazing-fast-wordpress-with-nginx-and-memcached/">Blazing fast WordPress with Nginx and Memcached</a> </h3> <p></p><p>Inspired by Eric Mann’s post on <a href="http://eamann.com/tech/ludicrous-speed-wordpress-caching-with-redis/">caching WordPress with Redis</a>, I thought I’d experiment with a similar setup using Memcached. Any in-memory caching system should work just as well, but I’ve chosen Memcached because it’s already running on my server and because PHP already has a <a href="http://www.php.net/manual/en/class.memcached.php">built-in libmemcached API</a>.</p> <p>My current setup is Nginx and PHP-FPM, with WP Super Cache. The cache is saved to the filesystem, allowing Nginx to serve static files (which it is <a href="http://nbonvin.wordpress.com/2011/03/14/apache-vs-nginx-vs-varnish-vs-gwan/">very good at</a>) without needing to pass any requests to PHP. This setup has worked very well, so I’ll be using it as a baseline.</p> <p>To use Memcached, every request needs to be passed to PHP. My gut feeling was that this would be slower than serving static files with Nginx due to the overhead of spinning up a PHP process for each request.</p> <h2>Benchmarks</h2> <p>To find out which of the two setups was faster, I measured the following metrics using <a href="http://www.webpagetest.org/">WebPagetest</a> and <a href="http://www.blitz.io/bhm0Fw2xDFNoGcFXNKJaQSu">Blitz</a> :</p> <ul> <li>Time To First Byte (although CloudFlare has speculated that <a href="http://blog.cloudflare.com/ttfb-time-to-first-byte-considered-meaningles">TTFB is a meaningless metric</a>)</li> <li>Average response time</li> <li>Average hit rate</li> </ul> <a href="/blazing-fast-wordpress-with-nginx-and-memcached/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">May 20, 2013</span> <h3> <a class="post-summary__link" href="/increasing-the-size-of-the-lish-console/">Increasing the size of the LISH console</a> </h3> <p></p><p>If you’ve used Linode’s LISH console to get remote access to your server, you’re probably familiar with the way the console wraps everything to 60x20 (columns x rows) - even when you’re connected via ssh in a much larger terminal.</p> <a href="/increasing-the-size-of-the-lish-console/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">Sep 22, 2012</span> <h3> <a class="post-summary__link" href="/solving-502-bad-gateway-with-nginx-php-fpm/">Solving "502 Bad Gateway" with nginx & php-fpm</a> </h3> <p></p><p>After upgrading php-fpm, my PHP-based sites were returning “502 Bad Gateway” errors. This can happen when the php5-fpm package reconfigures itself to listen on a different socket. Here’s how you can solve it.</p> <p>Check to make sure that php-fpm is running with <code>ps aux | grep php</code> - if you can’t see any php-fpm processes in the output, then you may need to re-install php-fpm. If php-fpm is running okay, then skip this first step.</p> <div><pre><code>sudo apt-get remove php5 php5-cgi php5-fpm
sudo apt-get install php5 php5-cgi php5-fpm
</code></pre> </div> <p>The thing to notice here is that the order in which you install the packages is important. In the past I have found that installing them in the wrong order causes the packages to be configured incorrectly.</p> <p>Next, get php-fpm to listen on the correct host/port. In <code>/etc/php5/fpm/pool.d/www.conf</code> change the <code>listen</code> value to match the <code>fastcgi_pass</code> location in your Nginx configuration. For example, I changed mine from:</p> <div><pre><code>listen = /var/run/php5-fpm.sock
</code></pre> </div> <p>To:</p> <div><pre><code>listen = 127.0.0.1:9000
</code></pre> </div> <p>If you are configuring php-fpm to listen on a Unix socket, you should also check that the socket file has the correct owner and permissions. While I wouldn’t recommend it, you can simply give read-write permissions to all with <code>sudo chmod go+rw /var/run/php5-fpm.sock</code>.</p> <p>Restart php-fpm with <code>sudo service php5-fpm restart</code> and everything should work normally again.</p> <a href="/solving-502-bad-gateway-with-nginx-php-fpm/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">May 3, 2012</span> <h3> <a class="post-summary__link" href="/automatic-mysql-backups/">Automatic MySQL Backups</a> </h3> <p></p><p>It’s really easy to set up automatic MySQL backups using <code>mysqldump</code>. First, you need to set up a user with <code>SELECT</code> and <code>LOCK TABLES</code> privileges. In this example the user doesn’t have a password.</p> <div><pre><code>CREATE USER 'autobackup'@'localhost';
GRANT SELECT, LOCK TABLES ON *.* TO 'autobackup'@'localhost';
</code></pre> </div> <p>Next create the cron job with <code>crontab -e</code>. This job is set to run every day at 5:20am.</p> <div><pre><code>20 5 * * * mysqldump --user=autobackup **dbname** | gzip -c &gt; /var/backups/**dbname**-`/bin/date +\%Y\%m\%d`.sql.gz
</code></pre> </div> <p>Don’t forget to change <strong>dbname</strong> to the name of the database that you want to backup. And that’s it - you’re done! This cron job will create a backup of your database and save it to <code>/var/backups</code> with a filename based on the current date, e.g. <code>/var/backups/**dbname**-20120503.sql.gz</code></p> <a href="/automatic-mysql-backups/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">Aug 20, 2011</span> <h3> <a class="post-summary__link" href="/deploying-a-git-repository-to-a-remote-server/">Deploying a Git repository to a remote server</a> </h3> <p></p><p>Git’s <code>archive</code> command is basically the equivalent of SVN’s <code>export</code> – it dumps a copy of the entire repository without any of the version control files, making it perfect for deploying to a testing or production server.</p> <a href="/deploying-a-git-repository-to-a-remote-server/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">Jul 23, 2011</span> <h3> <a class="post-summary__link" href="/setting-up-a-web-server-on-ubuntudebian/">Setting up a Web Server on Ubuntu/Debian</a> </h3> <p></p><p>Setting up a web server with Apache, PHP, and MySQL on any Debian-based system is really easy thanks to APT (Advanced Packaging Tool). Follow along and you’ll have a web server set up within fifteen minutes.</p> <a href="/setting-up-a-web-server-on-ubuntudebian/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">May 22, 2011</span> <h3> <a class="post-summary__link" href="/recursively-chmod-directories-only/">Recursively chmod Directories Only</a> </h3> <p></p><p>The <code>find</code> utility’s -exec flag makes it very easy to recursively perform operations on specific files or directories.</p> <div><pre><code>find . -type d -exec chmod 755 {} \;
</code></pre> </div> <p>This command finds all directories (starting at ‘dot’ - the current directory) and sets their permissions to 755 (rwxr-xr-x).</p> <div><pre><code>find . -type f -exec chmod 644 {} \;
</code></pre> </div> <p>Similarly, this command finds all files and sets their permissions to 644 (rw-r–r–).</p> <p> </p> <p>Thanks to <a href="http://movabletripe.com/archive/recursively-chmod-directories-only/">moveabletripe</a> for the info.</p> <a href="/recursively-chmod-directories-only/">(Read more)</a> </article> <article class="post-summary"> <span class="post-summary__meta">May 20, 2011</span> <h3> <a class="post-summary__link" href="/dynamic-virtual-hosts-using-htaccess/">Dynamic Virtual Hosts Using .htaccess</a> </h3> <p></p><p>There are several ways to set up virtual hosts on your web server. One of the more common methods is to manually create a <code>[&lt;VirtualHost&gt;](http://httpd.apache.org/docs/2.0/mod/core.html#virtualhost)</code> record for each virtual host. While using this method is fine, it can end you up with a huge configuration file that is difficult to manage.</p> <p>Because all of my virtual hosts are sub-directories of my web server’s base directory, I prefer to dynamically allocate the virtual host directory based on the host name. For example, I want wildlyinaccurate.localhost to point to /var/www/wildlyinaccurate. This can be achieved by modifying the .htaccess file of your web server’s base directory:</p> <a href="/dynamic-virtual-hosts-using-htaccess/">(Read more)</a> </article> </section> <footer class="page-footer"> <ul class="social-media"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="social-media__icon"> <svg viewBox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span class="username">wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/Joseph_Wynn"> <span class="social-media__icon"> <svg viewBox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span class="username">Joseph_Wynn</span> </a> </li> </ul> <p class="site-description site-description--footer">A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News. </p> </footer> <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-20744182-3', 'auto');
          ga('send', 'pageview');</script> <script>(function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.src = '//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('p');
                p.appendChild(s);

                n = document.querySelector('.post-content > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })();</script> </body> </html>