<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Dishonest comments | Wildly Inaccurate</title> <meta name="description" content="One of my favourite Ruby Rogues episodes (What Makes Beautiful Code) has a short section where the Rogues talk about the concept of dishonest code. David Brady wrote a really good piece on this, which I highly recommend reading.What I want to talk..."> <link rel="stylesheet" href="/css/main.094aeab.css"> <link rel="canonical" href="https://wildlyinaccurate.com/dishonest-comments"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> </head> <body> <nav class="navbar"> <div class="container"> <a href="https://wildlyinaccurate.com" class="navbar__title navbar__link">Wildly Inaccurate</a> <ul class="navbar-nav"> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/about/">About</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/projects/">Projects</a> </li> <li class="navbar-nav__item"> <a class="navbar-nav__item-link navbar__link" href="/search/">Search</a> </li> </ul> </div> </nav> <header class="page-header page-header--no-meta"> <img class="page-header__featured-image" src="/assets/default-featured-image.jpg" srcset="/assets/resized/default-featured-image-320x134.jpg 320w, /assets/resized/default-featured-image-360x150.jpg 360w, /assets/resized/default-featured-image-720x301.jpg 720w, /assets/resized/default-featured-image-940x393.jpg 940w, /assets/resized/default-featured-image-1140x476.jpg 1140w, /assets/resized/default-featured-image-1280x535.jpg 1280w, /assets/resized/default-featured-image-1360x568.jpg 1360w, /assets/resized/default-featured-image-1680x702.jpg 1680w, /assets/resized/default-featured-image-1840x769.jpg 1840w,  /assets/default-featured-image.jpg 2600w"> <div class="container"> <h1 class="page-header__title">Dishonest comments</h1> <p class="post-meta--header"> Aug 7, 2013 • by Joseph Wynn • posted in <span class="post-meta__data"> [<a href="/category/Thoughts/">Thoughts</a>] </span> </p> </div> </header> <article class="post-content"> <p>One of my favourite Ruby Rogues episodes (<a href="http://rubyrogues.com/what-makes-beautiful-code/"><em>What Makes Beautiful Code</em></a>) has a short section where the Rogues talk about the concept of <em>dishonest code</em>. David Brady wrote a <a href="http://chalain.livejournal.com/39332.html">really good piece</a> on this, which I highly recommend reading.</p> <p>What I want to talk about is a more specific variant of dishonest code: dishonest comments.</p> <p>Take this code, for example:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s1">'a'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">});</span>
</code></pre> </div> <p>If you’re not familiar with JavaScript events, <code class="highlighter-rouge">e.stopPropagation()</code> will stop this event from bubbling up to other event handlers. Now, what if somebody decides that the event <em>should</em> bubble up? They might do something like this:</p> <div class="language-diff highlighter-rouge"><pre class="highlight"><code><span class="gd">--- a/example.js
</span><span class="gi">+++ b/example.js
</span><span class="gu">@@ -1,4 +1,4 @@
</span> $('a').click(function(e) {
<span class="gi">+    // Let the event bubble up to the next handler
</span><span class="gd">-    e.stopPropagation();
</span>     e.preventDefault();
 });
</code></pre> </div> <p>This is pretty common practice; a developer will leave a comment so that the next person understands why the <code class="highlighter-rouge">e.stopPropagation()</code> is gone.<!--more--></p> <p>So far this isn’t too bad. But what happens when somebody changes their mind again, and doesn’t want the event to bubble up any more? Quite often, this is what happens:</p> <div class="language-diff highlighter-rouge"><pre class="highlight"><code><span class="gd">--- a/example.js
</span><span class="gi">+++ b/example.js
</span><span class="gu">@@ -1,4 +1,5 @@
</span> $('a').click(function(e) {
     // Let the event bubble up to the next handler
<span class="gi">+    e.stopPropagation();
</span>     e.preventDefault();
 });
</code></pre> </div> <p>The <code class="highlighter-rouge">e.stopPropagation()</code> call is added back in, right where it was before. You can see the problem here: the comment explaining that the event will bubble up is still there.</p> <p>A lot of developers tend to ignore comments in code, especially comments that were written by somebody else. Modern text editors and IDEs are partly to blame for this, since their syntax highlighting tends to de-emphasise comments by greying them out.</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s1">'a'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Let the event bubble up to the next handler</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">});</span>
</code></pre> </div> <p>What we’ve ended up with is a comment which says one thing, and some code which does something <em>entirely different</em>. This is surprisingly common – most codebases are absolutely <em>littered</em> with dishonest comments.</p> <p>The example I’ve given above might seem contrived, but this is an entirely real —although somewhat simplified— example of some code that I had to debug recently.</p> <p>Dishonest comments can confuse even the most experienced developers, and make debugging much more difficult than it needs to be. Figuring out what one line of code is <em>supposed</em> to do can turn into an hour of trawling through version control logs and diffs.</p> <p>The worst part about dishonest comments is that the problems they cause aren’t immediately obvious. Unit tests won’t pick them up. A full regression test won’t find them. Once they’re committed to the codebase, they remain hidden right up until the point where you realise that they’re lying to you.</p> <p>So really, the only way to avoid dishonest comments is to simply <strong>not write them in the first place</strong>.</p> <p>In the Ruby Rogues episode I mentioned at the start of this post, there’s a brief discussion about the idea that comments are a code smell. This idea is <a href="http://programmers.stackexchange.com/questions/1/comments-are-a-code-smell">hotly debated</a>. However, I do believe that treating comments as a code smell can help you to identify dishonest comments before they become a problem.</p> <p>I think this ends up coming back to the way that syntax highlighting hides comments from us. It’s really difficult to spot dishonest comments because we’ve trained our brains to focus on the bright &amp; colourful text, and ignore the dull grey text.</p> <div class="thumbnail"> <img class="thumbnail__image" alt="Greyed-out comments" src="/assets/hidden-comments.png" width="430" srcset="/assets/resized/hidden-comments-320x304.png 320w, /assets/resized/hidden-comments-360x342.png 360w,  /assets/hidden-comments.png 430w"> <div class="thumbnail__caption"> Greyed-out comments </div> </div> <p>If you opened this file to make some changes, chances are you wouldn’t even notice the comments, let alone figure out that they are all lies. But what if the comments stood out more?</p> <p>I’m currently experimenting with my own variation of the Monokai colour scheme which draws comments in a bright colour.</p> <div class="thumbnail"> <img class="thumbnail__image" alt="Bright comments" src="/assets/bright-comments.png" width="430" srcset="/assets/resized/bright-comments-320x304.png 320w, /assets/resized/bright-comments-360x342.png 360w,  /assets/bright-comments.png 430w"> <div class="thumbnail__caption"> Bright comments </div> </div> <p>Suddenly the comments stand out. They even stand out more than most of the actual code in this file. To me, this is a good thing because comments should only be there to say something important that the code can’t say by itself. If there is a comment in the code, I want it to stand out because it must be telling me something <strong>really important</strong>.</p> <p>Having the comments stand out more also makes it much more obvious when there are too many comments. Usually, seeing a lot of comments tells me that either:</p> <ol> <li>Most of these comments are unnecessary, or,</li> <li>The code needs to be refactored to be self-documenting</li> </ol> <p>If the comments are unnecessary, they can be removed. If the code can be more self-documenting, then the comments that <em>were</em> documenting it can be removed. Either way, you end up with less comments, and less dishonesty.</p> <p>How you deal with dishonest comments in your codebase is up to you. In the end though, it’s down to you and your team to be more thoughtful about the comments that you write. If an honest comment can be turned into a dishonest comment simply by changing the code around it, then you probably need to re-think whether that comment is necessary.</p> </article> <footer class="post-meta post-meta--footer"> <p> This post was written by <strong>Joseph Wynn</strong> on <strong>7 August, 2013</strong>, and last updated on <strong>24 July, 2016</strong>. It was posted in <span class="post-meta__data"> [<a href="/category/Thoughts/">Thoughts</a>] </span> and tagged with <span class="post-meta__data"> [<a href="/tag/comments/">comments</a>] </span> </p> </footer> <div class="post-comments" id="disqus_thread"></div> <script>var disqus_shortname = 'wildlyinaccurate';
    var disqus_url = 'https://wildlyinaccurate.com/dishonest-comments';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script> <footer class="page-footer"> <ul class="social-media"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="social-media__icon"> <svg viewBox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span class="username">wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/Joseph_Wynn"> <span class="social-media__icon"> <svg viewBox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span class="username">Joseph_Wynn</span> </a> </li> </ul> <p class="site-description site-description--footer">A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News. </p> </footer> <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-20744182-3', 'auto');
          ga('send', 'pageview');</script> <script>(function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.src = '//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('p');
                p.appendChild(s);

                n = document.querySelector('.post-content > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })();</script> </body> </html>