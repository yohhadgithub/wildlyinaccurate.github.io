<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Tag: php-fpm | Wildly Inaccurate</title> <meta name="description" content="A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News.
"> <style>ol,p,pre,ul{margin-top:0}a,table{background-color:transparent}hr,ol,p,pre,ul{margin-bottom:1rem}.wrap,img{max-width:100%}.va-m,img{vertical-align:middle}#carbonads,.ta-c{text-align:center}article,footer,header,nav,section{display:block}.btn,.d-ib{display:inline-block}a{-webkit-text-decoration-skip:objects;color:#8e44ad;text-decoration:none;transition-duration:.3s}a:active,a:hover{outline-width:0}b,strong{font-weight:bolder}small{font-size:80%}img{border-style:none;height:auto}svg:not(:root){overflow:hidden}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:16px;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent}*,::after,::before{box-sizing:inherit}@-ms-viewport{width:device-width}body{margin:0;font-family:serif;font-size:1.32rem;font-weight:400;line-height:1.5;color:#292b2c;background-color:#fff}.btn,h1,h2,h3,h4,h5{font-family:sans-serif}h1,h2,h3,h4,h5{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.1;color:inherit}ul ul{margin-bottom:0}blockquote{margin:0 0 1rem;border-left:5px solid #ddd;padding:1rem 2rem .25rem}a:focus,a:hover{color:#612e76;text-decoration:underline}a:focus{outline:-webkit-focus-ring-color auto 5px;outline-offset:-2px}pre{overflow:auto;border:1px solid #ddd;padding:.8rem}a,input{touch-action:manipulation}table{border-collapse:collapse}input{line-height:inherit}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5{font-size:1.25rem}hr{box-sizing:content-box;height:0;overflow:visible;margin-top:1rem;border:0;border-top:1px solid #636c72}.mt-4,.my-4{margin-top:1.5rem!important}.mb-4,.my-4{margin-bottom:1.5rem!important}small{font-weight:400}.btn{background:#8e44ad;color:#fff}.btn:focus,.btn:hover{background:rgba(142,68,173,.8);color:#fff}.btn--inverse{background:rgba(255,255,255,.67);color:#8e44ad}.btn--inverse:focus,.btn--inverse:hover{background:rgba(255,255,255,.4)}code,pre{background:#f7f7f9;font-size:.875rem}code{padding:.2rem .4rem}pre code{padding:0}.wrap{margin-left:auto;margin-right:auto;padding-right:15px;padding-left:15px;width:1140px}@media (min-width:576px){.wrap{padding-right:15px;padding-left:15px;width:540px;max-width:100%}}@media (min-width:768px){.wrap{padding-right:15px;padding-left:15px;width:720px;max-width:100%}}@media (min-width:992px){.wrap{padding-right:15px;padding-left:15px;width:960px;max-width:100%}}.ls-n{list-style:none}.page-header{color:#fff;min-height:240px;overflow:hidden;position:relative;text-shadow:-1px 0 1px #000}.page-header a{color:#fff}.c-gl{color:#636c72}.z-1{z-index:1}.z--1{z-index:-1}.f-r{float:right}.pos-a{position:absolute}.b-0{bottom:0}.h-100{height:100%}.h-4{height:1.5rem}.w-100{width:100%}.w-4{width:1.5rem}.mt-5{margin-top:3rem!important}.p-0{padding:0!important}.py-1{padding-top:.25rem!important;padding-bottom:.25rem!important}.p-2{padding:.5rem!important}.pt-2{padding-top:.5rem!important}.p-3{padding:1rem!important}.pb-3{padding-bottom:1rem!important}.pt-4{padding-top:1.5rem!important}.pt-5{padding-top:3rem!important}@media (min-width:576px){.h-sm-a{height:auto}.p-sm-3{padding:1rem!important}}@media (min-width:992px){.pt-lg-4{padding-top:1.5rem!important}}#carbonads{max-width:200px}#carbonads,.carbon-img>img{margin:0 auto}.carbon-poweredby,.carbon-text{color:#292b2c;display:block;font-size:.75rem;margin-top:1rem}</style> <link rel="canonical" href="https://wildlyinaccurate.com/tag/php-fpm"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> </head> <body> <nav class="pos-a w-100 z-1"> <div class="wrap"> <a class="btn p-2 p-sm-3" href="https://wildlyinaccurate.com">Wildly Inaccurate</a> <div class="f-r"> <a class="btn btn--inverse p-2 p-sm-3" href="/about/">About</a> <a class="btn btn--inverse p-2 p-sm-3" href="/projects/">Projects</a> <a class="btn btn--inverse p-2 p-sm-3" href="/search/">Search</a> </div> </div> </nav> <header class="page-header mb-4"> <img class="pos-a b-0 h-100 h-sm-a z--1" src="/assets/default-featured-image.jpg" srcset="/assets/resized/default-featured-image-320x134.jpg 320w, /assets/resized/default-featured-image-360x150.jpg 360w, /assets/resized/default-featured-image-720x301.jpg 720w, /assets/resized/default-featured-image-940x393.jpg 940w, /assets/resized/default-featured-image-1140x476.jpg 1140w, /assets/resized/default-featured-image-1280x535.jpg 1280w, /assets/resized/default-featured-image-1360x568.jpg 1360w, /assets/resized/default-featured-image-1680x702.jpg 1680w, /assets/resized/default-featured-image-1840x769.jpg 1840w, /assets/default-featured-image.jpg 2600w"> <div class="wrap pt-5"> <h1 class="mt-5">Tag: php-fpm</h1> </div> </header> <section class="wrap"> <article class="pb-3"> <span class="f-r c-gl">May 20, 2013</span> <h3> <a href="/blazing-fast-wordpress-with-nginx-and-memcached/">Blazing fast WordPress with Nginx and Memcached</a> </h3> <p></p><p>Inspired by Eric Mann&#x2019;s post on <a href="http://eamann.com/tech/ludicrous-speed-wordpress-caching-with-redis/">caching WordPress with Redis</a>, I thought I&#x2019;d experiment with a similar setup using Memcached. Any in-memory caching system should work just as well, but I&#x2019;ve chosen Memcached because it&#x2019;s already running on my server and because PHP already has a <a href="http://www.php.net/manual/en/class.memcached.php">built-in libmemcached API</a>.</p> <p>My current setup is Nginx and PHP-FPM, with WP Super Cache. The cache is saved to the filesystem, allowing Nginx to serve static files (which it is <a href="http://nbonvin.wordpress.com/2011/03/14/apache-vs-nginx-vs-varnish-vs-gwan/">very good at</a>) without needing to pass any requests to PHP. This setup has worked very well, so I&#x2019;ll be using it as a baseline.</p> <p>To use Memcached, every request needs to be passed to PHP. My gut feeling was that this would be slower than serving static files with Nginx due to the overhead of spinning up a PHP process for each request.</p> <h2>Benchmarks</h2> <p>To find out which of the two setups was faster, I measured the following metrics using <a href="http://www.webpagetest.org/">WebPagetest</a> and <a href="http://www.blitz.io/bhm0Fw2xDFNoGcFXNKJaQSu">Blitz</a>&#xA0;:</p> <ul> <li>Time To First Byte (although CloudFlare has speculated that <a href="http://blog.cloudflare.com/ttfb-time-to-first-byte-considered-meaningles">TTFB is a meaningless metric</a>)</li> <li>Average response time</li> <li>Average hit rate</li> </ul> <a href="/blazing-fast-wordpress-with-nginx-and-memcached/">(Read more)</a><p></p> </article> <article class="pb-3"> <span class="f-r c-gl">Sep 22, 2012</span> <h3> <a href="/solving-502-bad-gateway-with-nginx-php-fpm/">Solving &quot;502 Bad Gateway&quot; with nginx &amp; php-fpm</a> </h3> <p></p><p>After upgrading php-fpm, my PHP-based sites were returning &#x201C;502 Bad Gateway&#x201D; errors. This can happen when the php5-fpm package reconfigures itself to listen on a different socket. Here&#x2019;s how you can solve it.</p> <p>Check to make sure that php-fpm is running with&#xA0;<code>ps aux | grep php</code> - if you can&#x2019;t see any php-fpm processes in the output, then you may need to re-install php-fpm. If php-fpm is running okay, then skip this first step.</p> <div><pre><code>sudo apt-get remove php5 php5-cgi php5-fpm
sudo apt-get install php5 php5-cgi php5-fpm
</code></pre> </div> <p>The thing to notice here is that the order in which you install the packages is important. In the past I have found that installing them in the wrong order causes the packages to be configured incorrectly.</p> <p>Next, get php-fpm to listen on the correct host/port. In <code>/etc/php5/fpm/pool.d/www.conf</code> change the <code>listen</code> value to match the <code>fastcgi_pass</code> location in&#xA0;your Nginx configuration. For example, I changed mine from:</p> <div><pre><code>listen = /var/run/php5-fpm.sock
</code></pre> </div> <p>To:</p> <div><pre><code>listen = 127.0.0.1:9000
</code></pre> </div> <p>If you&#xA0;are&#xA0;configuring php-fpm to listen on a Unix socket, you should also check that the socket file has the correct owner and permissions. While I wouldn&#x2019;t recommend it, you can&#xA0;simply give read-write permissions to all with <code>sudo chmod go+rw /var/run/php5-fpm.sock</code>.</p> <p>Restart php-fpm with <code>sudo service&#xA0;php5-fpm restart</code> and everything should work normally again.</p> <a href="/solving-502-bad-gateway-with-nginx-php-fpm/">(Read more)</a><p></p> </article> </section> <footer class="wrap mt-5"> <hr> <ul class="ls-n f-r"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span>wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/joseph_wynn"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span>joseph_wynn</span> </a> </li> </ul> <small> <i>A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News. </i> </small> </footer> <script defer="defer"> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-20744182-3', 'auto');
          ga('send', 'pageview'); </script> <script defer="defer"> (function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.src = '//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('p');
                p.appendChild(s);

                n = document.querySelector('article > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })(); </script> </body> </html> 